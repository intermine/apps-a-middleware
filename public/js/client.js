// Generated by CoffeeScript 1.3.3
(function() {
  var $, ReportWidgets, root;

  $ = jQuery || Zepto;

  root = this;

  ReportWidgets = (function() {

    ReportWidgets.prototype.selectorPrefix = 'w';

    function ReportWidgets(server) {
      var _this = this;
      this.server = server;
      console.log("Initialize ReportWidgets for " + this.server);
      $.ajax({
        'url': "" + this.server + "/widgets",
        'dataType': 'json',
        success: function(data) {
          console.log("Got config for " + server);
          return _this.config = data;
        }
      });
    }

    ReportWidgets.prototype.load = function(widgetId, target) {
      var deps, run,
        _this = this;
      if (!(this.config != null)) {
        return window.setTimeout((function() {
          return _this.load(widgetId, target);
        }), 0);
      } else {
        run = function() {
          var callback;
          callback = 24517;
          console.log("Getting widget " + widgetId);
          return $.ajax({
            'url': "" + _this.server + "/widget/" + callback + "/" + widgetId,
            'dataType': 'script',
            success: function() {
              var widget;
              $(target).html($("<div/>", {
                'id': "" + _this.selectorPrefix + callback
              }));
              widget = root.intermine.temp.widgets[callback];
              return widget.render("#" + _this.selectorPrefix + callback);
            }
          });
        };
        deps = this.config[widgetId].dependencies;
        if (deps != null) {
          return root.intermine.load(deps, run);
        } else {
          return run;
        }
      }
    };

    return ReportWidgets;

  })();

  root.ReportWidgets = ReportWidgets;

}).call(this);
